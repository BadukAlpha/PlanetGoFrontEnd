<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Stats - PlanetGo</title>
    <link rel="stylesheet" href="ultra-modern.css">
    <script src="night-sky.js"></script>
</head>
<body>
    <!-- Dynamic Night Sky Scene -->
    <div class="night-sky-scene" id="nightSkyScene">
        <div class="twinkling-stars"></div>
        <div class="hill"></div>
        <div class="moon"></div>
        <div class="northern-lights" id="northernLights"></div>
    </div>

    <!-- Header -->
    <header class="header" id="header">
        <div class="hamburger" id="hamburger">
            <div class="astronaut-svg">
                <img src="astronaut.svg" alt="Astronaut" class="astronaut-icon">
            </div>
        </div>
        <div class="logo">PlanetGo</div>
        <div style="width: 50px;"></div>
    </header>
    
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Navigation</h2>
        </div>
        <ul class="sidebar-nav">
            <li><a href="home.html">üè† Home</a></li>
            <li><a href="group.html">üë• Group Page</a></li>
            <li><a href="tournaments.html">üèÜ Tournaments</a></li>
            <li><a href="tutor.html">üìö Tutorings</a></li>
            <li><a href="seasons.html">üéØ Seasons</a></li>
            <li><a href="goresources.html">üîó Go Resources</a></li>
            <li><a href="mystats.html" class="active">üìä Player Stats</a></li>
        </ul>
    </nav>
    
    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="stats-container">
            <!-- Page Header -->
            <div class="page-header">
                <h1>ÔøΩ Player Statistics</h1>
                <p>Search for any OGS player to view their game statistics and recent matches</p>
            </div>

            <!-- Search Section -->
            <div class="search-section">
                <div class="search-box">
                    <div class="search-form">
                        <input type="text" id="usernameInput" placeholder="Enter #PlayerID (e.g., #803789) or exact username..." class="search-input">
                        <button type="button" id="searchBtn" class="search-button">
                            <span class="search-icon">üîç</span>
                            Search
                        </button>
                    </div>
                    
                    <div class="search-options">
                        <div class="search-info">
                            <small>üí° <strong>Player ID recommended:</strong> Use your OGS Player ID with # prefix for instant results. For usernames, spelling must be exact.</small>
                        </div>
                        <div class="search-examples">
                            <strong>Examples:</strong>
                            <div class="example-item">
                                <span class="example-label">Player ID:</span>
                                <code>#123456</code>
                                <small>(from OGS profile URL)</small>
                            </div>
                            <div class="example-item">
                                <span class="example-label">Username:</span>
                                <code>YourUsername</code>
                                <small>(exact spelling required)</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Results -->
            <div id="statsContainer" class="stats-results" style="display: none;">
                <!-- Player Info Header -->
                <div id="playerInfo" class="player-info"></div>
                
                <!-- Comprehensive Game Statistics -->
                <div class="comprehensive-stats">
                    <div class="stats-grid">
                        <!-- Overall Stats -->
                        <div class="stat-card overall-stats">
                            <h3>üéØ Overall Statistics</h3>
                            <div class="stat-row">
                                <span class="stat-label">Total Games:</span>
                                <span class="stat-value" id="totalGames">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Wins:</span>
                                <span class="stat-value win" id="totalWins">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Losses:</span>
                                <span class="stat-value loss" id="totalLosses">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Win Rate:</span>
                                <span class="stat-value" id="winRate">-</span>
                            </div>
                        </div>

                        <!-- Color Statistics -->
                        <div class="stat-card color-stats">
                            <h3>‚ö´‚ö™ Color Statistics</h3>
                            <div class="color-breakdown">
                                <div class="color-section">
                                    <h4>As Black</h4>
                                    <div class="stat-row">
                                        <span class="stat-label">Games:</span>
                                        <span class="stat-value" id="blackGames">-</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Wins:</span>
                                        <span class="stat-value win" id="blackWins">-</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Win Rate:</span>
                                        <span class="stat-value" id="blackWinRate">-</span>
                                    </div>
                                </div>
                                <div class="color-section">
                                    <h4>As White</h4>
                                    <div class="stat-row">
                                        <span class="stat-label">Games:</span>
                                        <span class="stat-value" id="whiteGames">-</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Wins:</span>
                                        <span class="stat-value win" id="whiteWins">-</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Win Rate:</span>
                                        <span class="stat-value" id="whiteWinRate">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Game Type Statistics -->
                        <div class="stat-card game-type-stats">
                            <h3>üèÜ Game Type Breakdown</h3>
                            <div class="stat-row">
                                <span class="stat-label">Ranked Games:</span>
                                <span class="stat-value" id="rankedGames">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Ranked Wins:</span>
                                <span class="stat-value win" id="rankedWins">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Ranked Win Rate:</span>
                                <span class="stat-value" id="rankedWinRate">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Unranked Games:</span>
                                <span class="stat-value" id="unrankedGames">-</span>
                            </div>
                        </div>

                        <!-- Board Size Statistics -->
                        <div class="stat-card board-size-stats">
                            <h3>üìê Board Size Statistics</h3>
                            <div id="boardSizeBreakdown">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>

                        <!-- Opponent Strength Analysis -->
                        <div class="stat-card opponent-stats">
                            <h3>üë• Opponent Analysis</h3>
                            <div class="stat-row">
                                <span class="stat-label">vs Stronger Players:</span>
                                <span class="stat-value" id="vsStronger">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">vs Equal Players:</span>
                                <span class="stat-value" id="vsEqual">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">vs Weaker Players:</span>
                                <span class="stat-value" id="vsWeaker">-</span>
                            </div>
                        </div>

                        <!-- Time Control Statistics -->
                        <div class="stat-card time-stats">
                            <h3>‚è±Ô∏è Time Control Breakdown</h3>
                            <div id="timeControlBreakdown">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="stats-controls">
                    <div class="control-group">
                        <label for="gamesPerPage">Games per page:</label>
                        <select id="gamesPerPage" class="control-select black-select">
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="maxGames">Max games to load:</label>
                        <select id="maxGames" class="control-select black-select">
                            <option value="20" selected>20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                            <option value="5000">5000</option>
                        </select>
                    </div>
                    
                    <button id="refreshGames" class="refresh-button">üîÑ Refresh Games</button>
                </div>

                <!-- Games Table -->
                <div class="games-table-container">
                    <table id="gamesTable" class="games-table">
                        <thead>
                            <tr>
                                <th>Opponent</th>
                                <th>Color</th>
                                <th>Result</th>
                                <th>Date</th>
                                <th>Game Link</th>
                            </tr>
                        </thead>
                        <tbody id="gamesTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div id="pagination" class="pagination"></div>
                
                <!-- Loading indicator -->
                <div id="loadingGames" class="loading-indicator modern-loading" style="display: none;">
                    <div class="loading-animation">
                        <div class="cosmic-spinner">
                            <div class="ring ring-1"></div>
                            <div class="ring ring-2"></div>
                            <div class="ring ring-3"></div>
                            <div class="center-star">‚≠ê</div>
                        </div>
                        <div class="loading-text">
                            <p class="loading-title">Loading Game Data...</p>
                            <p class="loading-subtitle">Analyzing your cosmic Go journey</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom Modal -->
        <div id="customModal" class="custom-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Notification</h3>
                    <button class="modal-close" id="modalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="modalMessage"></p>
                </div>
                <div class="modal-footer">
                    <button id="modalOk" class="modal-button">OK</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentPlayer = null;
        let allGames = [];
        let currentPage = 1;
        let gamesPerPage = 10;

        // DOM elements
        const usernameInput = document.getElementById('usernameInput');
        const searchBtn = document.getElementById('searchBtn');
        const statsContainer = document.getElementById('statsContainer');
        const playerInfo = document.getElementById('playerInfo');
        const gamesPerPageSelect = document.getElementById('gamesPerPage');
        const maxGamesSelect = document.getElementById('maxGames');
        const refreshGamesBtn = document.getElementById('refreshGames');
        const gamesTableBody = document.getElementById('gamesTableBody');
        const pagination = document.getElementById('pagination');
        const loadingGames = document.getElementById('loadingGames');

        // Custom modal functions
        function showModal(title, message) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('customModal').style.display = 'flex';
        }

        function hideModal() {
            document.getElementById('customModal').style.display = 'none';
        }

        // Event listeners for modal
        document.getElementById('modalClose').addEventListener('click', hideModal);
        document.getElementById('modalOk').addEventListener('click', hideModal);
        document.getElementById('customModal').addEventListener('click', function(e) {
            if (e.target === this) hideModal();
        });

        // Search functionality
        searchBtn.addEventListener('click', searchPlayer);
        usernameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchPlayer();
        });

        async function searchPlayer() {
            const query = usernameInput.value.trim();
            if (!query) {
                showModal('Input Required', 'Please enter a Player ID (with # prefix) or exact username.');
                return;
            }

            // Hide previous results
            statsContainer.style.display = 'none';

            try {
                // Check if query starts with # (indicating it's a Player ID)
                if (query.startsWith('#')) {
                    const playerId = query.substring(1); // Remove the # prefix
                    if (/^\d+$/.test(playerId)) {
                        showModal('Loading...', `Loading player data for ID: ${playerId}`);
                        await loadPlayerById(parseInt(playerId));
                    } else {
                        showModal('Invalid ID Format', 'Player ID must be numeric after the # symbol (e.g., #803789)');
                        return;
                    }
                } else if (/^\d+$/.test(query)) {
                    // Legacy support: pure numeric input still works as ID
                    showModal('Loading...', `Loading player data for ID: ${query}`);
                    await loadPlayerById(parseInt(query));
                } else {
                    // Try as exact username only
                    showModal('Searching...', `Searching for exact username: ${query}`);
                    await searchByUsername(query);
                }
            } catch (error) {
                console.error('Search error:', error);
                showModal('Search Error', 'An error occurred while searching. Please try again.');
            }
        }

        async function loadPlayerById(playerId) {
            try {
                const maxGames = parseInt(maxGamesSelect.value);
                showModal('Loading...', `Loading player data and ${maxGames} games...`);
                
                const response = await fetch(`https://planet-go-back-end.vercel.app/api/stats?playerId=${playerId}&pageSize=${maxGames}&ordering=-ended`);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                    hideModal();
                    if (response.status === 404) {
                        showModal('Player Not Found', `No player exists with ID: ${playerId}. Please check the ID and try again.`);
                    } else {
                        showModal('Error', errorData.error || `Failed to load player (Error ${response.status})`);
                    }
                    return;
                }
                
                const data = await response.json();
                if (data.success && data.player) {
                    currentPlayer = data.player;
                    
                    // Filter out active games (games in progress)
                    allGames = (data.games.results || []).filter(game => 
                        game.ended !== null && game.ended !== undefined
                    );
                    
                    hideModal(); // Hide loading modal
                    displayPlayerStats(data.player);
                    calculateComprehensiveStats();
                    displayGames();
                    setupPagination();
                } else {
                    hideModal();
                    showModal('Error', 'Failed to load player information.');
                }
            } catch (error) {
                console.error('Error loading player by ID:', error);
                hideModal();
                showModal('Network Error', 'Failed to connect to the server. Please check your internet connection and try again.');
            }
        }

        async function searchByUsername(username) {
            try {
                // Direct OGS API call for exact username search only
                const response = await fetch(`https://online-go.com/api/v1/players?username=${encodeURIComponent(username)}`);
                const data = await response.json();
                
                hideModal(); // Hide searching modal
                
                if (!response.ok || !data.results || data.results.length === 0) {
                    showModal('No Results', `No player found with exact username "${username}". Please check the spelling or use their Player ID instead.`);
                    return;
                }

                // Look for exact match only
                const exactMatch = data.results.find(p => p.username.toLowerCase() === username.toLowerCase());
                
                if (exactMatch) {
                    // Exact match found - load directly
                    showModal('Loading...', `Loading games for ${exactMatch.username}...`);
                    await loadPlayerById(exactMatch.id);
                } else {
                    showModal('No Exact Match', `No exact match found for "${username}". Please check the spelling or use their Player ID for guaranteed results.`);
                }
            } catch (error) {
                console.error('Error in username search:', error);
                hideModal();
                showModal('Network Error', 'Failed to connect to OGS. Please check your internet connection and try again.');
            }
        }

        function displayPlayerStats(player) {
            playerInfo.innerHTML = `
                <div class="player-header">
                    <h2>${player.username}</h2>
                    <div class="player-details">
                        <span class="rank">${player.ranking || 'Unranked'}</span>
                        <span class="player-id">ID: ${player.id}</span>
                    </div>
                </div>
            `;
            
            statsContainer.style.display = 'block';
            currentPage = 1;
            displayGames();
            setupPagination();
        }

        async function loadGames() {
            if (!currentPlayer) return;
            
            loadingGames.style.display = 'block';
            const maxGames = parseInt(maxGamesSelect.value);
            
            try {
                const response = await fetch(`https://planet-go-back-end.vercel.app/api/stats?playerId=${currentPlayer.id}&pageSize=${maxGames}&ordering=-ended`);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    showModal('Error', errorData.error || 'Failed to load games.');
                    return;
                }
                
                const data = await response.json();
                
                if (data.success && data.games) {
                    // Filter out active games (games in progress)
                    allGames = (data.games.results || []).filter(game => 
                        game.ended !== null && game.ended !== undefined
                    );
                    currentPage = 1;
                    calculateComprehensiveStats();
                    displayGames();
                    setupPagination();
                } else {
                    showModal('Error', 'Failed to load games.');
                }
            } catch (error) {
                console.error('Error loading games:', error);
                showModal('Error', 'Failed to load games.');
            } finally {
                loadingGames.style.display = 'none';
            }
        }

        function displayGames() {
            gamesPerPage = parseInt(gamesPerPageSelect.value);
            const start = (currentPage - 1) * gamesPerPage;
            const end = start + gamesPerPage;
            const pagingatedGames = allGames.slice(start, end);
            
            gamesTableBody.innerHTML = '';
            
            pagingatedGames.forEach(game => {
                const row = document.createElement('tr');
                
                // Determine player color and opponent
                const isBlack = game.players.black.id === currentPlayer.id;
                const opponent = isBlack ? game.players.white : game.players.black;
                const playerColor = isBlack ? 'Black' : 'White';
                
                // Determine result - only show W or L
                let result = '-';
                if (game.ended) {
                    const winner = game.black_lost ? 'white' : 'black';
                    const playerWon = (isBlack && winner === 'black') || (!isBlack && winner === 'white');
                    result = playerWon ? 'W' : 'L';
                }
                
                // Format date
                const date = new Date(game.ended || game.started).toLocaleDateString();
                
                row.innerHTML = `
                    <td class="opponent-cell">
                        <span class="opponent-name">${opponent.username}</span>
                        <span class="opponent-rank">${opponent.ranking ? Math.round(opponent.ranking) + 'k' : 'Unranked'}</span>
                    </td>
                    <td><span class="color-badge ${playerColor.toLowerCase()}">${playerColor}</span></td>
                    <td><span class="result ${result === 'W' ? 'win' : result === 'L' ? 'loss' : 'unknown'}">${result}</span></td>
                    <td class="date-cell">${date}</td>
                    <td><a href="https://online-go.com/game/${game.id}" target="_blank" class="game-link">View</a></td>
                `;
                
                gamesTableBody.appendChild(row);
            });
        }

        function calculateComprehensiveStats() {
            if (!allGames || allGames.length === 0) return;
            
            let stats = {
                total: allGames.length,
                wins: 0,
                losses: 0,
                blackGames: 0,
                blackWins: 0,
                whiteGames: 0,
                whiteWins: 0,
                rankedGames: 0,
                rankedWins: 0,
                unrankedGames: 0,
                boardSizes: {},
                timeControls: {},
                opponentStrength: { stronger: 0, equal: 0, weaker: 0 }
            };
            
            allGames.forEach(game => {
                const isBlack = game.players.black.id === currentPlayer.id;
                const opponent = isBlack ? game.players.white : game.players.black;
                const winner = game.black_lost ? 'white' : 'black';
                const playerWon = (isBlack && winner === 'black') || (!isBlack && winner === 'white');
                
                // Basic stats
                if (playerWon) stats.wins++;
                else stats.losses++;
                
                // Color stats
                if (isBlack) {
                    stats.blackGames++;
                    if (playerWon) stats.blackWins++;
                } else {
                    stats.whiteGames++;
                    if (playerWon) stats.whiteWins++;
                }
                
                // Ranked vs unranked
                if (game.ranked) {
                    stats.rankedGames++;
                    if (playerWon) stats.rankedWins++;
                } else {
                    stats.unrankedGames++;
                }
                
                // Board sizes
                const boardSize = `${game.width}x${game.height}`;
                if (!stats.boardSizes[boardSize]) {
                    stats.boardSizes[boardSize] = { games: 0, wins: 0 };
                }
                stats.boardSizes[boardSize].games++;
                if (playerWon) stats.boardSizes[boardSize].wins++;
                
                // Time controls
                const timeControl = game.time_control || 'Unknown';
                if (!stats.timeControls[timeControl]) {
                    stats.timeControls[timeControl] = { games: 0, wins: 0 };
                }
                stats.timeControls[timeControl].games++;
                if (playerWon) stats.timeControls[timeControl].wins++;
                
                // Opponent strength analysis
                const playerRank = currentPlayer.ranking || 25;
                const opponentRank = opponent.ranking || 25;
                if (opponentRank < playerRank - 1) stats.opponentStrength.stronger++;
                else if (Math.abs(opponentRank - playerRank) <= 1) stats.opponentStrength.equal++;
                else stats.opponentStrength.weaker++;
            });
            
            // Update UI
            document.getElementById('totalGames').textContent = stats.total;
            document.getElementById('totalWins').textContent = stats.wins;
            document.getElementById('totalLosses').textContent = stats.losses;
            document.getElementById('winRate').textContent = `${((stats.wins / stats.total) * 100).toFixed(1)}%`;
            
            document.getElementById('blackGames').textContent = stats.blackGames;
            document.getElementById('blackWins').textContent = stats.blackWins;
            document.getElementById('blackWinRate').textContent = stats.blackGames > 0 ? `${((stats.blackWins / stats.blackGames) * 100).toFixed(1)}%` : '0%';
            
            document.getElementById('whiteGames').textContent = stats.whiteGames;
            document.getElementById('whiteWins').textContent = stats.whiteWins;
            document.getElementById('whiteWinRate').textContent = stats.whiteGames > 0 ? `${((stats.whiteWins / stats.whiteGames) * 100).toFixed(1)}%` : '0%';
            
            document.getElementById('rankedGames').textContent = stats.rankedGames;
            document.getElementById('rankedWins').textContent = stats.rankedWins;
            document.getElementById('rankedWinRate').textContent = stats.rankedGames > 0 ? `${((stats.rankedWins / stats.rankedGames) * 100).toFixed(1)}%` : '0%';
            document.getElementById('unrankedGames').textContent = stats.unrankedGames;
            
            document.getElementById('vsStronger').textContent = `${stats.opponentStrength.stronger} games`;
            document.getElementById('vsEqual').textContent = `${stats.opponentStrength.equal} games`;
            document.getElementById('vsWeaker').textContent = `${stats.opponentStrength.weaker} games`;
            
            // Board size breakdown
            const boardSizeEl = document.getElementById('boardSizeBreakdown');
            boardSizeEl.innerHTML = '';
            Object.entries(stats.boardSizes).forEach(([size, data]) => {
                const winRate = ((data.wins / data.games) * 100).toFixed(1);
                boardSizeEl.innerHTML += `
                    <div class="stat-row">
                        <span class="stat-label">${size}:</span>
                        <span class="stat-value">${data.games} games (${winRate}% win rate)</span>
                    </div>
                `;
            });
            
            // Time control breakdown
            const timeControlEl = document.getElementById('timeControlBreakdown');
            timeControlEl.innerHTML = '';
            Object.entries(stats.timeControls).forEach(([control, data]) => {
                const winRate = ((data.wins / data.games) * 100).toFixed(1);
                const displayControl = control.charAt(0).toUpperCase() + control.slice(1);
                timeControlEl.innerHTML += `
                    <div class="stat-row">
                        <span class="stat-label">${displayControl}:</span>
                        <span class="stat-value">${data.games} games (${winRate}% win rate)</span>
                    </div>
                `;
            });
        }

        function setupPagination() {
            const totalPages = Math.ceil(allGames.length / gamesPerPage);
            pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.textContent = '‚Üê Previous';
                prevBtn.className = 'pagination-btn';
                prevBtn.addEventListener('click', () => {
                    currentPage--;
                    displayGames();
                    setupPagination();
                });
                pagination.appendChild(prevBtn);
            }
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage || i === 1 || i === totalPages || Math.abs(i - currentPage) <= 2) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                    pageBtn.addEventListener('click', () => {
                        currentPage = i;
                        displayGames();
                        setupPagination();
                    });
                    pagination.appendChild(pageBtn);
                } else if (Math.abs(i - currentPage) === 3) {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    dots.className = 'pagination-dots';
                    pagination.appendChild(dots);
                }
            }
            
            // Next button
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.textContent = 'Next ‚Üí';
                nextBtn.className = 'pagination-btn';
                nextBtn.addEventListener('click', () => {
                    currentPage++;
                    displayGames();
                    setupPagination();
                });
                pagination.appendChild(nextBtn);
            }
        }

        // Control event listeners
        gamesPerPageSelect.addEventListener('change', () => {
            currentPage = 1;
            displayGames();
            setupPagination();
        });

        maxGamesSelect.addEventListener('change', loadGames);
        refreshGamesBtn.addEventListener('click', loadGames);

        // Sidebar functionality
        const hamburger = document.getElementById('hamburger');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const header = document.getElementById('header');
        const mainContent = document.getElementById('mainContent');
        let sidebarOpen = false;
        
        function toggleSidebar() {
            sidebarOpen = !sidebarOpen;
            if (sidebarOpen) {
                sidebar.classList.add('open');
                overlay.classList.add('open');
                hamburger.classList.add('active');
                header.classList.add('sidebar-open');
                mainContent.classList.add('sidebar-open');
            } else {
                sidebar.classList.remove('open');
                overlay.classList.remove('open');
                hamburger.classList.remove('active');
                header.classList.remove('sidebar-open');
                mainContent.classList.remove('sidebar-open');
            }
        }
        
        hamburger.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && sidebarOpen) {
                toggleSidebar();
            }
        });
    </script>
</body>
</html>

.